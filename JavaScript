document.addEventListener('DOMContentLoaded', function() {
    const obituaryForm = document.getElementById('obituary-form');
    const musicButtons = document.querySelectorAll('.music-options button');
    const audioPreview = document.getElementById('audio-preview');
    let selectedMusicUrl = '';

    musicButtons.forEach(button => {
        button.addEventListener('click', function() {
            selectedMusicUrl = this.getAttribute('data-music-url');
            audioPreview.src = selectedMusicUrl;
            audioPreview.hidden = false;
            audioPreview.play();
        });
    });

    obituaryForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(obituaryForm);
        const deceasedName = formData.get('deceased-name');
        const birthDate = formData.get('birth-date');
        const deathDate = formData.get('death-date');
        const funeralDate = formData.get('funeral-date');
        const funeralLocation = formData.get('funeral-location');
        const hall = formData.get('hall');
        const textStyle = formData.get('text-style');
        const sendFlowerBasket = formData.get('send-flower-basket');
        const photoFile = formData.get('photo-upload');

        const reader = new FileReader();
        reader.onload = function(event) {
            const photoUrl = event.target.result;

            const urlParams = new URLSearchParams({
                deceasedName,
                birthDate,
                deathDate,
                funeralDate,
                funeralLocation,
                hall,
                textStyle,
                sendFlowerBasket,
                photoUrl,
                musicUrl: selectedMusicUrl
            });

            window.location.href = 'details.html?' + urlParams.toString();
        };
        reader.readAsDataURL(photoFile);
    });
});
