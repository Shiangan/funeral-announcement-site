document.getElementById('funeral-location').addEventListener('change', function() {
    const location = this.value;
    const hallSelect = document.getElementById('hall');
    hallSelect.innerHTML = '';

    if (location === '第二殯儀館') {
        hallSelect.innerHTML = `
            <option value="A廳">A廳</option>
            <option value="B廳">B廳</option>
        `;
    } else if (location === '新北板橋殯儀館') {
        hallSelect.innerHTML = `
            <option value="C廳">C廳</option>
            <option value="D廳">D廳</option>
        `;
    } else if (location === '桃園殯儀館') {
        hallSelect.innerHTML = `
            <option value="E廳">E廳</option>
            <option value="F廳">F廳</option>
        `;
    } else if (location === '南榮殯儀館') {
        hallSelect.innerHTML = `
            <option value="G廳">G廳</option>
            <option value="H廳">H廳</option>
        `;
    }

    hallSelect.disabled = false;
});

document.getElementById('preview-music').addEventListener('click', function() {
    const musicChoice = document.getElementById('music-choice').value;
    const audioPreview = document.getElementById('audio-preview');
    if (musicChoice) {
        audioPreview.src = musicChoice;
        audioPreview.hidden = false;
        audioPreview.play();
    }
});

document.getElementById('obituary-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(this);
    const queryString = new URLSearchParams(formData).toString();
    const photoFile = document.getElementById('photo-upload').files[0];
    const musicChoice = document.getElementById('music-choice').value;

    // 假設照片會上傳到某個服務器，並且返回一個照片URL
    // 這裡直接使用FileReader模擬照片上傳的效果
    const reader = new FileReader();
    reader.onloadend = function() {
        const photoUrl = reader.result;
        const redirectUrl = `details.html?${queryString}&photoUrl=${encodeURIComponent(photoUrl)}&musicUrl=${encodeURIComponent(musicChoice)}`;
        window.location.href = redirectUrl;
    };
    reader.readAsDataURL(photoFile);
});
